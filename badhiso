local player = game.Players.LocalPlayer
local screenGui = Instance.new("ScreenGui")
screenGui.ResetOnSpawn = false
screenGui.Name = "TeleportUI"
screenGui.Parent = player:WaitForChild("PlayerGui")

local teleportEnabled = false
local targetPlayer = nil
local teleportDistance = 10
local offsetY = 1
local uiOpen = true

-- ğŸ”µ ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ 
local boxFrame = Instance.new("Frame")
boxFrame.Size = UDim2.new(0, 250, 0, 350)
boxFrame.Position = UDim2.new(1, -260, 0.5, -175)
boxFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- èƒŒæ™¯è‰²ã‚’é»’ã«å¤‰æ›´
boxFrame.BorderSizePixel = 0
boxFrame.Active = true
boxFrame.Draggable = true  -- â† ã“ã‚Œã§ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ï¼
boxFrame.Parent = screenGui

-- ğŸ”½ æŠ˜ã‚ŠãŸãŸã¿ãƒœã‚¿ãƒ³
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 30, 0, 30)
toggleButton.Position = UDim2.new(1, -35, 0, 5)
toggleButton.AnchorPoint = Vector2.new(1, 0)
toggleButton.Text = "â–²"
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  -- ãƒœã‚¿ãƒ³ã®è‰²ã‚’é»’ã«å¤‰æ›´
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ãƒ†ã‚­ã‚¹ãƒˆã¯ç™½
toggleButton.Parent = boxFrame

-- ğŸ“œ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒªã‚¹ãƒˆ
local playerList = Instance.new("ScrollingFrame")
playerList.Size = UDim2.new(1, -20, 0, 240)
playerList.Position = UDim2.new(0, 10, 0, 40)
playerList.CanvasSize = UDim2.new(0, 0, 0, 0)
playerList.ScrollBarThickness = 8
playerList.BackgroundColor3 = Color3.fromRGB(0, 0, 0)  -- èƒŒæ™¯è‰²ã‚’é»’ã«å¤‰æ›´
playerList.BackgroundTransparency = 0.5  -- ã¡ã‚‡ã£ã¨é€æ˜ã«ã—ã¦èƒŒæ™¯ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
playerList.ScrollBarImageColor3 = Color3.fromRGB(255, 255, 255)  -- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®è‰²ã‚’ç™½ã«å¤‰æ›´
playerList.Parent = boxFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = playerList

-- ğŸ”„ æ›´æ–°ãƒœã‚¿ãƒ³
local refreshButton = Instance.new("TextButton")
refreshButton.Size = UDim2.new(0.5, -5, 0, 40)
refreshButton.Position = UDim2.new(0, 10, 0, 290)
refreshButton.Text = "ğŸ”„ æ›´æ–°"
refreshButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  -- èƒŒæ™¯è‰²ã‚’é»’ã«å¤‰æ›´
refreshButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ãƒ†ã‚­ã‚¹ãƒˆã¯ç™½
refreshButton.Parent = boxFrame

-- âŒ ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
local resetButton = Instance.new("TextButton")
resetButton.Size = UDim2.new(0.5, -5, 0, 40)
resetButton.Position = UDim2.new(0.5, 5, 0, 290)
resetButton.Text = "âŒ ãƒªã‚»ãƒƒãƒˆ"
resetButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  -- èƒŒæ™¯è‰²ã‚’é»’ã«å¤‰æ›´
resetButton.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ãƒ†ã‚­ã‚¹ãƒˆã¯ç™½
resetButton.Parent = boxFrame

-- ğŸ‘¤ é¸æŠä¸­ãƒ©ãƒ™ãƒ«
local selectedLabel = Instance.new("TextLabel")
selectedLabel.Size = UDim2.new(1, -20, 0, 30)
selectedLabel.Position = UDim2.new(0, 10, 0, 330)
selectedLabel.BackgroundTransparency = 1
selectedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ãƒ†ã‚­ã‚¹ãƒˆã¯ç™½
selectedLabel.Text = "é¸æŠä¸­: ãªã—"
selectedLabel.TextScaled = true
selectedLabel.Parent = boxFrame

local mouse = player:GetMouse()
local UserInputService = game:GetService("UserInputService")

-- ğŸ“‹ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆæ›´æ–°
local function refreshPlayerList()
    for _, child in pairs(playerList:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end

    for _, otherPlayer in ipairs(game.Players:GetPlayers()) do
        if otherPlayer ~= player then
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, 0, 0, 30)

            -- ğŸ”¹ è¡¨ç¤ºåï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼‰ã®å½¢å¼ã«ã™ã‚‹
            local displayName = otherPlayer.DisplayName
            local username = otherPlayer.Name
            button.Text = string.format("%s (%s)", displayName, username)

            button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  -- èƒŒæ™¯è‰²ã‚’é»’ã«å¤‰æ›´
            button.TextColor3 = Color3.fromRGB(255, 255, 255)  -- ãƒ†ã‚­ã‚¹ãƒˆã¯ç™½
            button.Parent = playerList

            button.MouseButton1Click:Connect(function()
                targetPlayer = otherPlayer
                selectedLabel.Text = "é¸æŠä¸­: " .. displayName .. "ï¼ˆ" .. username .. "ï¼‰"
            end)
        end
    end

    task.wait()
    playerList.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y)
end

-- ğŸ§² ãƒ†ãƒ¬ãƒãƒ¼ãƒˆ
local function teleportToSelf()
    if teleportEnabled and targetPlayer then
        local rootPart = targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart")
        local playerRoot = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if rootPart and playerRoot then
            local forwardDirection = playerRoot.CFrame.LookVector
            local targetPosition = playerRoot.Position + forwardDirection * teleportDistance + Vector3.new(0, offsetY, 0)
            rootPart.CFrame = CFrame.new(targetPosition)
        end
    end
end

-- ğŸ“¦ æŠ˜ã‚ŠãŸãŸã¿å‡¦ç†
local function updateUIVisibility()
    local show = uiOpen
    playerList.Visible = show
    refreshButton.Visible = show
    resetButton.Visible = show
    selectedLabel.Visible = show

    if show then
        toggleButton.Text = "â–²"
        boxFrame.Size = UDim2.new(0, 250, 0, 370)
    else
        toggleButton.Text = "â–¼"
        boxFrame.Size = UDim2.new(0, 250, 0, 40)
    end
end

toggleButton.MouseButton1Click:Connect(function()
    uiOpen = not uiOpen
    updateUIVisibility()
end)

-- ğŸ® ãƒã‚¦ã‚¹å³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ†ãƒ¬ãƒãƒ¼ãƒˆ
mouse.Button2Down:Connect(function()
    if targetPlayer then
        teleportEnabled = true
    end
end)

mouse.Button2Up:Connect(function()
    teleportEnabled = false
end)

-- ğŸ“¦ ãƒœã‚¿ãƒ³å‹•ä½œ
refreshButton.MouseButton1Click:Connect(refreshPlayerList)

resetButton.MouseButton1Click:Connect(function()
    targetPlayer = nil
    selectedLabel.Text = "é¸æŠä¸­: ãªã—"
end)

-- ğŸ‘¥ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥é€€å‡ºã§æ›´æ–°
game.Players.PlayerAdded:Connect(refreshPlayerList)
game.Players.PlayerRemoving:Connect(refreshPlayerList)

-- ğŸ«€ æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ã§ãƒ†ãƒ¬ãƒãƒ¼ãƒˆå‡¦ç†
game:GetService("RunService").Heartbeat:Connect(teleportToSelf)

-- âœ… åˆæœŸè¡¨ç¤º
updateUIVisibility()
refreshPlayerList()

-- Uã‚­ãƒ¼ã§ãƒ†ãƒ¬ãƒãƒ¼ãƒˆã®ã‚ªãƒ³/ã‚ªãƒ•ã‚’åˆ‡ã‚Šæ›¿ãˆ
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent then return end

    if input.KeyCode == Enum.KeyCode.U then
        teleportEnabled = not teleportEnabled
        if teleportEnabled then
            print("ãƒ†ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒã‚ªãƒ³ã«ãªã‚Šã¾ã—ãŸã€‚")
        else
            print("ãƒ†ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒã‚ªãƒ•ã«ãªã‚Šã¾ã—ãŸã€‚")
        end
    end
end)
