--// Bounty Scoreboard UI（キーなし / 選択で即テレポート）

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

function createMainUI()

	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "BountyScoreboardUI"
	screenGui.ResetOnSpawn = false
	screenGui.Parent = PlayerGui

	local mainFrame = Instance.new("Frame")
	mainFrame.Size = UDim2.new(0, 320, 0, 420)
	mainFrame.Position = UDim2.new(1, -340, 0.3, 0)
	mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	mainFrame.BackgroundTransparency = 0.3
	mainFrame.BorderSizePixel = 0
	mainFrame.Active = true
	mainFrame.Draggable = true
	mainFrame.Parent = screenGui

	local bountyLabel = Instance.new("TextLabel")
	bountyLabel.Size = UDim2.new(1, -100, 0, 30)
	bountyLabel.Position = UDim2.new(0, 10, 0, 5)
	bountyLabel.BackgroundTransparency = 1
	bountyLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
	bountyLabel.TextScaled = true
	bountyLabel.Font = Enum.Font.SourceSansBold
	bountyLabel.TextXAlignment = Enum.TextXAlignment.Left
	bountyLabel.Text = "Bounty: 0"
	bountyLabel.Parent = mainFrame

	local toggleButton = Instance.new("TextButton")
	toggleButton.Size = UDim2.new(0, 30, 0, 30)
	toggleButton.Position = UDim2.new(1, -35, 0, 5)
	toggleButton.AnchorPoint = Vector2.new(1, 0)
	toggleButton.Text = "▲"
	toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	toggleButton.TextColor3 = Color3.new(1, 1, 1)
	toggleButton.Parent = mainFrame

	local deleteButton = Instance.new("TextButton")
	deleteButton.Size = UDim2.new(0, 30, 0, 30)
	deleteButton.Position = UDim2.new(1, -70, 0, 5)
	deleteButton.AnchorPoint = Vector2.new(1, 0)
	deleteButton.Text = "✖"
	deleteButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
	deleteButton.TextColor3 = Color3.new(1, 1, 1)
	deleteButton.TextScaled = true
	deleteButton.Parent = mainFrame

	local header = Instance.new("TextLabel")
	header.Size = UDim2.new(1, -20, 0, 30)
	header.Position = UDim2.new(0, 10, 0, 40)
	header.BackgroundTransparency = 1
	header.Text = "名前 / ID / Lv / Bounty / 持ち物"
	header.TextColor3 = Color3.new(1, 1, 1)
	header.TextSize = 14
	header.Font = Enum.Font.SourceSansBold
	header.TextXAlignment = Enum.TextXAlignment.Left
	header.Parent = mainFrame

	local playerList = Instance.new("ScrollingFrame")
	playerList.Size = UDim2.new(1, -20, 0, 180)
	playerList.Position = UDim2.new(0, 10, 0, 70)
	playerList.ScrollBarThickness = 6
	playerList.BackgroundTransparency = 1
	playerList.AutomaticCanvasSize = Enum.AutomaticSize.Y
	playerList.Parent = mainFrame

	local listLayout = Instance.new("UIListLayout")
	listLayout.Parent = playerList

	local itemLabel = Instance.new("TextLabel")
	itemLabel.Size = UDim2.new(1, -20, 0, 50)
	itemLabel.Position = UDim2.new(0, 10, 0, 260)
	itemLabel.BackgroundTransparency = 1
	itemLabel.TextColor3 = Color3.new(1, 1, 1)
	itemLabel.TextScaled = true
	itemLabel.TextWrapped = true
	itemLabel.Text = "持ち物: "
	itemLabel.Font = Enum.Font.SourceSansBold
	itemLabel.Parent = mainFrame

	local selectedLabel = Instance.new("TextLabel")
	selectedLabel.Size = UDim2.new(1, -20, 0, 30)
	selectedLabel.Position = UDim2.new(0, 10, 1, -90)
	selectedLabel.BackgroundTransparency = 1
	selectedLabel.TextColor3 = Color3.new(1, 1, 1)
	selectedLabel.Text = "選択中: なし"
	selectedLabel.TextScaled = true
	selectedLabel.Parent = mainFrame

	local refreshButton = Instance.new("TextButton")
	refreshButton.Size = UDim2.new(0.5, -5, 0, 40)
	refreshButton.Position = UDim2.new(0, 10, 1, -50)
	refreshButton.Text = "更新"
	refreshButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	refreshButton.TextColor3 = Color3.new(1, 1, 1)
	refreshButton.Parent = mainFrame

	local resetButton = Instance.new("TextButton")
	resetButton.Size = UDim2.new(0.5, -5, 0, 40)
	resetButton.Position = UDim2.new(0.5, 5, 1, -50)
	resetButton.Text = "リセット"
	resetButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	resetButton.TextColor3 = Color3.new(1, 1, 1)
	resetButton.Parent = mainFrame

	local targetPlayer = nil
	local teleportEnabled = false
	local teleportDistance = 10
	local offsetY = 1
	local uiOpen = true

	local function formatMillion(value)
		if value >= 1000000 then
			return string.format("%.1fm", value / 1000000)
		end
		return tostring(value)
	end

	local function getTools(player)
		local items = {}
		local bp = player:FindFirstChild("Backpack")
		if bp then
			for _, tool in ipairs(bp:GetChildren()) do
				if tool:IsA("Tool") then
					table.insert(items, tool.Name)
				end
			end
		end
		return table.concat(items, ", ")
	end

	local function refreshPlayerList()
		for _, child in pairs(playerList:GetChildren()) do
			if child:IsA("TextButton") then
				child:Destroy()
			end
		end

		for _, p in ipairs(Players:GetPlayers()) do
			if p == LocalPlayer then continue end

			local bounty = 0
			local lv = 0

			if p:FindFirstChild("leaderstats") and p.leaderstats:FindFirstChild("Bounty/Honor") then
				bounty = p.leaderstats["Bounty/Honor"].Value
			end

			if p:FindFirstChild("Data") and p.Data:FindFirstChild("Level") then
				lv = p.Data.Level.Value
			end

			local button = Instance.new("TextButton")
			button.Size = UDim2.new(1, 0, 0, 30)
			button.Text = string.format("%s / %s / %d / %s",
				p.DisplayName,
				p.Name,
				lv,
				formatMillion(bounty)
			)
			button.TextColor3 = Color3.new(1,1,1)
			button.BackgroundTransparency = 0.4
			button.BackgroundColor3 = Color3.fromRGB(30,30,30)
			button.Parent = playerList

			button.MouseButton1Click:Connect(function()
				targetPlayer = p
				selectedLabel.Text = "選択中: " .. p.DisplayName
				itemLabel.Text = "持ち物: " .. getTools(p)

				-- 選択した瞬間テレポートON
				teleportEnabled = true
			end)
		end
	end

	local function updateOwnBounty()
		local ls = LocalPlayer:FindFirstChild("leaderstats")
		if ls and ls:FindFirstChild("Bounty/Honor") then
			bountyLabel.Text = "Bounty: " .. tostring(ls["Bounty/Honor"].Value)
		end
	end

	local function teleportToSelf()
		if teleportEnabled and targetPlayer then
			local rootPart = targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart")
			local playerRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")

			if rootPart and playerRoot then
				local forward = playerRoot.CFrame.LookVector
				local pos = playerRoot.Position + forward * teleportDistance + Vector3.new(0, offsetY, 0)
				rootPart.CFrame = CFrame.new(pos)
			end
		end
	end

	RunService.Heartbeat:Connect(function()
		teleportToSelf()
		updateOwnBounty()
	end)

	toggleButton.MouseButton1Click:Connect(function()
		uiOpen = not uiOpen
		playerList.Visible = uiOpen
		refreshButton.Visible = uiOpen
		resetButton.Visible = uiOpen
		selectedLabel.Visible = uiOpen
		itemLabel.Visible = uiOpen
		bountyLabel.Visible = uiOpen
		toggleButton.Text = uiOpen and "▲" or "▼"
	end)

	deleteButton.MouseButton1Click:Connect(function()
		screenGui:Destroy()
	end)

	refreshButton.MouseButton1Click:Connect(refreshPlayerList)

	resetButton.MouseButton1Click:Connect(function()
		targetPlayer = nil
		teleportEnabled = false
		selectedLabel.Text = "選択中: なし"
		itemLabel.Text = "持ち物: "
	end)

	Players.PlayerAdded:Connect(refreshPlayerList)
	Players.PlayerRemoving:Connect(refreshPlayerList)

	refreshPlayerList()
end

-- UI起動
createMainUI()
